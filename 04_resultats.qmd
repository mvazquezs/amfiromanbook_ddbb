# Resultats

## Configuració i Càrrega de Dades

Abans de presentar els resultats, executem el codi necessari per carregar les llibreries i les dades, i per realitzar els càlculs d'imputació. Aquest bloc de codi no es mostrarà a l'informe final.

```{r setup-and-load}
#| label: setup-and-load
#| include: false

# Carreguem el paquet personalitzat 'amphitools' i les seves dependències
library(amphitools)
amphi_load_packages(update_packages = FALSE)

# Carreguem les dades de Vázquez, filtrant per a l'anàlisi
df_ample_vazq <- load_dimensions_vazquez(
  filtrar_edifici = 'amphitheater',
  filtrar_provincia = c('hispania', 'panonia', 'britania'),
  seleccionar_columnes = c(contains('amplada'), contains('alcada'), -contains('cavea'), -'bib')
)

# Realitzem la imputació de dades perdudes
tab_01_geom <- imputacio_estadistics(df = df_ample_vazq, seleccio_variables = c(contains('amplada'), contains('alcada')), grup_by = 'nom', metode_imputacio = 'geometrica')
tab_01_missforest <- imputacio_missforest(df = df_ample_vazq, seleccio_variables = c(contains('amplada'), contains('alcada')), grup_by = 'nom', set_seed = 19810424)
```

En aquest capítol, presentem els resultats de l'anàlisi de les dimensions dels amfiteatres romans. L'exposició s'estructura en tres parts principals: una anàlisi descriptiva de les dades, el procés d'imputació de valors perduts i, finalment, l'anàlisi inferencial per a la comparació entre grups.

## Anàlisi Descriptiva

Comencem amb una exploració de les dades per entendre les seves característiques principals.

### Estadístiques Descriptives

A la taula següent, es mostren les principals estadístiques descriptives per a les variables dimensionals dels amfiteatres.

```{r tab-descriptius}
#| label: tbl-descriptius
#| tbl-cap: "Estadístiques descriptives de les dimensions dels amfiteatres (dades originals de Vázquez)."

tab_03_ori_vazq <- tab_summary(
    df = df_ample_vazq,
    grup_by = 'nom',
    seleccio_variables = c(contains('amplada'), contains('alcada')),
    addicio_info = c('index_id', 'provincia_romana', 'pais'))

gtsummary::tbl_summary(tab_03_ori_vazq %>% dplyr::select(-c(n, na)), by = variable)
```

Aquesta taula inclou el nombre d'observacions, la mitjana, la desviació estàndard, els quartils i altres mètriques que ens informen sobre la distribució i la dispersió de cada variable.

### Visualització de les Dades

Per complementar la taula descriptiva, els següents gràfics mostren la distribució de les principals variables dimensionals.

```{r fig-distribucions}
#| label: fig-distribucions
#| fig-cap: "Distribucions de les dimensions principals."
#| layout-ncol: 2

# Aquí generaries els gràfics (p. ex., histogrames o boxplots amb ggplot2)
# library(ggplot2)
# 
# ggplot(df_amfiteatres, aes(x = amplada_general)) +
#   geom_histogram(bins = 15) +
#   labs(title = "Distribució de l'Amplada General")
# 
# ggplot(df_amfiteatres, aes(x = amplada_arena)) +
#   geom_histogram(bins = 15) +
#   labs(title = "Distribució de l'Amplada de l'Arena")
#
# ggplot(df_amfiteatres, aes(y = amplada_general, x = provincia_romana)) +
#   geom_boxplot() +
#   labs(title = "Amplada General per Província") +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

### Taules de Contingència

Per explorar la relació entre variables categòriques, com la província romana i el país, hem creat les següents taules de contingència.

```{r tab-contingencia}
#| label: tbl-contingencia
#| tbl-cap: "Taula de contingència entre Província Romana i País."

# Aquí cridaries la teva funció amphi_crosstab.
# amphi_crosstab(
#   phen = df_amfiteatres,
#   vars_x = "provincia_romana",
#   vars_y = "pais"
# )
```

## Imputació de Dades Absents

Durant l'anàlisi exploratòria, es van identificar valors absents en variables clau. Per abordar aquest problema, es va aplicar un mètode d'imputació.

En aquesta secció, es detalla el mètode d'imputació seleccionat i es mostra l'efecte de la imputació sobre la distribució de les dades.

```{r imputacio}
#| label: fig-imputacio
#| fig-cap: "Comparació de les distribucions abans i després de la imputació."

# Aquí executaries la imputació i guardaries els resultats.
# df_imputat <- imputacio_val_perduts(
#   df = df_amfiteatres,
#   seleccio_variables = c(amplada_general, amplada_arena, alcada_general, alcada_arena),
#   metode_imputacio = 'missForest', # O el mètode que prefereixis
#   retornar_originals = FALSE
# )

# Després, podries visualitzar les diferències, per exemple amb gràfics de densitat.
# library(ggplot2)
# library(tidyr)
# 
# # Creant un dataframe per a la comparació
# df_comparacio <- rbind(
#   data.frame(df_amfiteatres[c("amplada_general")], tipus = "Original"),
#   data.frame(amplada_general = df_imputat$amplada_general, tipus = "Imputat")
# )
# 
# ggplot(df_comparacio, aes(x = amplada_general, fill = tipus)) +
#   geom_density(alpha = 0.5) +
#   labs(title = "Distribució de l'Amplada General Abans i Després de la Imputació")

```

## Anàlisi Inferencial

Un cop les dades han estat preparades i imputades, procedim a realitzar anàlisis inferencials per comparar les dimensions dels amfiteatres entre diferents grups.

### Comparacions Bivariades

Aquí s'examinen les diferències entre dos grups utilitzant proves com el T-test o el test de Wilcoxon, segons la distribució de les dades.

```{r test-bivariat}
#| label: tbl-test-bivariat
#| tbl-cap: "Resultats del test de Wilcoxon per a l'amplada de l'arena entre dues províncies."

# Aquí cridaries la teva funció amphi_stat_test.
# Per exemple, per comparar 'hispania_baetica' vs 'hispania_tarraconensis'
# df_dos_provincies <- df_imputat %>% 
#   filter(provincia_romana %in% c("hispania_baetica", "hispania_tarraconensis"))
# 
# amphi_stat_test(
#   df = df_dos_provincies,
#   vars_x = "provincia_romana",
#   vars_y = "amplada_arena",
#   stat_tests = "wilcox_test"
# )
```

### Comparacions Múltiples

Per analitzar les diferències entre més de dos grups (per exemple, entre totes les províncies romanes), s'utilitzen proves com Kruskal-Wallis seguida d'una prova post-hoc com el test de Dunn.

```{r test-multivariat}
#| label: tbl-test-multivariat
#| tbl-cap: "Resultats del test de Kruskal-Wallis per a l'amplada general entre províncies."

# Aquí cridaries la teva funció amphi_stat_multitest.
# amphi_stat_multitest(
#   df = df_imputat,
#   vars_x = "provincia_romana",
#   vars_y = "amplada_general",
#   stat_tests = "kruskal_wallis"
# )
```

```{r test-dunn}
#| label: tbl-test-dunn
#| tbl-cap: "Resultats del test de Dunn per a comparacions per parelles."

# I la prova post-hoc
# amphi_stat_multitest(
#   df = df_imputat,
#   vars_x = "provincia_romana",
#   vars_y = "amplada_general",
#   stat_tests = "dunn",
#   adjust_method = "bonferroni" # Ajust de p-valor
# )
```

Aquests resultats ens permeten identificar quins grups d'amfiteatres presenten diferències estadísticament significatives en les seves dimensions.